---
title: "MAET Technology Survey - Results"
author: "Joshua Rosenberg"
date: "10/14/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Just comparing pre-post survey results

```{r}
library(googlesheets)
library(tidyverse)
library(prcr)

x <- gs_ls()
x
x %>% select(sheet_title) %>% filter(stringr::str_detect(sheet_title, "2013"))

# Pre

df1 <- gs_title('MAET 2013 Tech Survey (Responses) x')
df1 <- gs_read(df1, ws = 1)

df2 <- gs_title('MAET 2014 Tech Pre-Survey (Responses) x')
df2 <- gs_read(df2, ws = 1)

df3 <- gs_title('MAET 2015 Tech Pre-Survey (Responses)')
df3 <- gs_read(df3, ws = 1)
df3

df4 <- gs_title('MAET 2016 Tech Pre-Survey (Responses)')
df4 <- gs_read(df4, ws = 1)
df4 <- select(df4, -54, -53, -52, -51)
df4

df5 <- gs_title('MAET 2017 Tech Pre-Survey (Responses)')
df5 <- gs_read(df5, ws = 1)
df5 <- select(df5, -52, -51)
df5

nrow(df1) + nrow(df2) + nrow(df3) + nrow(df4) + nrow(df5)

names_df <- data_frame(names_df1 = names(df1),
                       names_df2 = names(df2),
                       names_df3 = names(df3),
                       names_df4 = names(df4),
                       names_df5 = names(df5))

names_df # checking these are all named the same

names(df1) <- names(df5)
names(df2) <- names(df5)
names(df3) <- names(df5)
names(df4) <- names(df5)
names(df5) <- names(df5)

df_pre <- bind_rows(df1, df2, df3, df4, df5) # 74 observations from five years

df_pre <- mutate(df_pre, 
                 date = lubridate::mdy_hms(Timestamp),
                 year = lubridate::year(date), 
                 time = "pre")

# Posts

x %>% 
  select(sheet_title) %>% 
  filter(stringr::str_detect(sheet_title, "2016"))

df1 <- gs_title('MAET 2013 Tech Post-survey  (Responses)')
df1 <- gs_read(df1, ws = 1)
df1

df2 <- gs_title('MAET 2014 Tech Post-Survey  (Responses)')
df2 <- gs_read(df2, ws = 1)
df2

df3 <- gs_title('MAET 2015 Tech Post-Survey  (Responses)')
df3 <- gs_read(df3, ws = 1)
df3

df4 <- gs_title('MAET 2016 Tech Post-Survey (Responses)')
df4 <- gs_read(df4, ws = 1)
df4 <- select(df4, -54, -53, -52, -51)
df4

df5 <- gs_title('MAET 2017 Tech Post-Survey (Responses)')
df5 <- gs_read(df5, ws = 1)
df5 <- select(df5, -54, -53, -52, -51)
df5

sd <- gs_title('Summary Data MAET Survey')
sd <- gs_read(sd, ws = 1)

nrow(df1) + nrow(df2) + nrow(df3) + nrow(df4) + nrow(df5) # 69 post obs 

names_df <- data_frame(names_df1 = names(df1),
                       names_df2 = names(df2),
                       names_df3 = names(df3),
                       names_df4 = names(df4),
                       names_df5 = names(df5))

names_df # checking these are named the same

names(df1) <- names(df5)
names(df2) <- names(df5)
names(df3) <- names(df5)
names(df4) <- names(df5)
names(df5) <- names(df5)

df_post <- bind_rows(df1, df2, df3, df4, df5)
df_pre <- rename(df_pre, "Most Important" = "Want to Learn More")

df_post <- mutate(df_post, 
                  date = lubridate::mdy_hms(Timestamp),
                  year = lubridate::year(date), 
                  time = "post")

# All

b <- gs_title('Summary Data MAET Survey')
b <- gs_read(b, ws = 1)
the_cat <- as.numeric(as.vector(unlist(b[b$Timestamp == "Type of variable", ])))
the_cat

d <- bind_rows(df_pre, df_post)
```

With all variables

```{r}
d %>%
  group_by(time) %>% 
  summarize_at(.vars = vars(`Overall Confidence`:`Navigate a Firewall`), mean) %>% 
  gather(key, val, -time) %>% 
  left_join(sd, by = "key") %>% 
  ggplot(aes(x = reorder(key, val), y = val, fill = time)) +
  geom_col(position = "dodge") +
  coord_flip() +
  xlab(NULL) +
  ylab("Value") +
  scale_fill_brewer("Survey Timepoint",  type = "qual") +
  theme_bw() +
  ggtitle("MAET Technology Survey Responses From 2013-2017 (n = 74)")
```

By grouping variables

Variable definitions:

* Overall: represents overall confidence and overall confidence for teaching and learning

* 1: represents don't do it / haven't done it over the past five years
* 2: represents may do it / have possibly done it over the past five years
* 3: represents definitely do it / have used it over the past five years

```{r}
x <- sd[1, ] %>% 
  select(-Timestamp, -date, -year, -`Want to Learn More`) %>% 
  gather(key, var_type, -time) %>% 
  mutate(var_type = case_when(
    var_type == "Overall" ~ "Overall",
    var_type == 1 ~ "Low Alignment",
    var_type == 2 ~ "Medium Alignment",
    var_type == 3 ~ "High Alignment"
  ))

d %>%
  select(-Timestamp, -date, -year, -`Most Important`) %>% 
  gather(key, val, -time) %>% 
  left_join(x, by = "key") %>% 
  rename(time = time.x) %>% 
  group_by(time, var_type) %>% 
  mutate(val= as.numeric(val)) %>% 
  summarize(mean_val = mean(val, na.rm = T)) %>% 
  ggplot(aes(x = reorder(var_type, mean_val), y = mean_val, fill = time)) +
  geom_col(position = "dodge") +
  coord_flip() +
  xlab(NULL) +
  ylab("Value") +
  scale_fill_brewer("Survey Timepoint",  type = "qual") +
  theme_bw() +
  ggtitle("MAET Technology Survey Responses From 2013-2017 (n = 74)")

d %>% 
  select(-Timestamp, -year, -date, -`Most Important`) %>% 
  gather(key, val, -time) %>% 
  left_join(x, by = "key") %>% 
  select(time = time.x, everything(), -time.y) %>% 
  filter(var_type == "Overall") %>% 
  tidyttest::t_test(val, time)

d %>% 
  select(-Timestamp, -year, -date, -`Most Important`) %>% 
  gather(key, val, -time) %>% 
  left_join(x, by = "key") %>% 
  select(time = time.x, everything(), -time.y) %>% 
  filter(var_type == "Low  Alignment") %>% 
  tidyttest::t_test(val, time)

d %>% 
  select(-Timestamp, -year, -date, -`Most Important`) %>% 
  gather(key, val, -time) %>% 
  left_join(x, by = "key") %>% 
  select(time = time.x, everything(), -time.y) %>% 
  filter(var_type == "Medium Alignment") %>% 
  tidyttest::t_test(val, time)

d %>% 
  select(-Timestamp, -year, -date, -`Most Important`) %>% 
  gather(key, val, -time) %>% 
  left_join(x, by = "key") %>% 
  select(time = time.x, everything(), -time.y) %>% 
  filter(var_type == "High Alignment") %>% 
  tidyttest::t_test(val, time)
```
